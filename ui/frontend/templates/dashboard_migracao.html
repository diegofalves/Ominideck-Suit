<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>OmniDeck | Dashboard de Migração</title>
  <style>
    :root {
      --bg: #081425;
      --card: #f6f9ff;
      --line: #d6e1f2;
      --ink: #12213f;
      --muted: #5a6f8f;
      --brand: #0f67ff;
      --brand-2: #0047c2;
      --ok: #13925c;
      --warn: #f59e0b;
      --danger: #dc2626;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Segoe UI", Tahoma, sans-serif;
      background:
        radial-gradient(900px 300px at 0% -8%, #0f67ff40 0%, transparent 45%),
        var(--bg);
      color: #e8f1ff;
      min-height: 100vh;
      padding: 22px;
    }

    .wrap { max-width: 1300px; margin: 0 auto; }

    .head {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: flex-start;
      margin-bottom: 14px;
    }

    .head h1 { font-size: clamp(1.55rem, 4vw, 2rem); margin-bottom: 4px; }
    .head p { color: #c3d8f7; font-size: 0.93rem; }

    .nav { display: flex; flex-wrap: wrap; gap: 8px; }
    .nav a {
      text-decoration: none;
      color: #d4e5ff;
      border: 1px solid #ffffff30;
      background: #ffffff14;
      border-radius: 999px;
      padding: 7px 12px;
      font-size: 0.84rem;
      font-weight: 700;
    }

    .grid-kpi {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 12px;
    }

    .kpi {
      background: var(--card);
      color: var(--ink);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
    }
    .kpi .label { color: var(--muted); font-size: 0.78rem; font-weight: 700; margin-bottom: 4px; }
    .kpi .value { font-size: 1.55rem; font-weight: 800; line-height: 1; }
    .kpi .sub { color: var(--muted); font-size: 0.8rem; margin-top: 4px; }

    .panel {
      background: var(--card);
      color: var(--ink);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .panel h2 { font-size: 1.04rem; margin-bottom: 10px; }

    .phases {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
    }

    .phase {
      border: 1px solid #dce7f7;
      border-radius: 12px;
      padding: 10px;
      background: #fbfdff;
    }
    .phase-title { font-size: 0.88rem; font-weight: 800; margin-bottom: 6px; color: #2f4c76; }
    .phase-numbers { font-size: 0.84rem; color: #4e678b; margin-bottom: 6px; }
    .bar {
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: #e6edf9;
      overflow: hidden;
    }
    .bar > span {
      display: block;
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(145deg, var(--brand), var(--brand-2));
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.86rem;
    }
    th, td {
      border-bottom: 1px solid #dee7f5;
      padding: 8px 6px;
      text-align: left;
      vertical-align: top;
    }
    th { color: #37517a; font-size: 0.77rem; text-transform: uppercase; letter-spacing: 0.04em; }
    td { color: #1b3154; }

    .chip {
      display: inline-block;
      border-radius: 999px;
      padding: 3px 8px;
      font-size: 0.74rem;
      font-weight: 800;
    }
    .chip.pending { background: #fff2d8; color: #7a5600; }
    .chip.progress { background: #dcebff; color: #12488c; }
    .chip.done { background: #d8f7ea; color: #0f5b3a; }

    .layout {
      display: grid;
      grid-template-columns: 1.15fr 1fr;
      gap: 12px;
    }

    .small-note {
      color: #5b7090;
      font-size: 0.81rem;
      margin-top: 8px;
    }

    @media (max-width: 1150px) {
      .grid-kpi { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .layout { grid-template-columns: 1fr; }
      .phases { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="head">
      <div>
        <h1>Dashboard de Evolução da Migração</h1>
        <p>Projeto: <strong>{{ dashboard.project_code }}</strong> · {{ dashboard.project_name }}</p>
      </div>
      <nav class="nav">
        <a href="/">Home</a>
        <a href="/projeto-migracao">Painel de Construção de Migração</a>
        <a href="/execucao-scripts">Execução de Scripts</a>
      </nav>
    </header>

    <section class="grid-kpi">
      <article class="kpi">
        <div class="label">Progresso Geral</div>
        <div class="value">{{ dashboard.overall_pct }}%</div>
        <div class="sub">Média das 3 fases</div>
      </article>
      <article class="kpi">
        <div class="label">MIGRATION_GROUPs</div>
        <div class="value">{{ dashboard.total_groups }}</div>
        <div class="sub">Grupos ativos no projeto</div>
      </article>
      <article class="kpi">
        <div class="label">MIGRATION_ITEMs</div>
        <div class="value">{{ dashboard.total_objects }}</div>
        <div class="sub">Itens considerados no monitoramento</div>
      </article>
      <article class="kpi">
        <div class="label">Itens Ignorados</div>
        <div class="value">{{ dashboard.ignored_objects }}</div>
        <div class="sub">Fora da evolução principal</div>
      </article>
      <article class="kpi">
        <div class="label">Itens Críticos</div>
        <div class="value">{{ dashboard.critical_items | length }}</div>
        <div class="sub">Top pendências priorizadas</div>
      </article>
    </section>

    <section class="panel">
      <h2>Progresso por Fase</h2>
      <div class="phases">
        <article class="phase">
          <div class="phase-title">Documentação</div>
          <div class="phase-numbers">{{ dashboard.phases.documentation.done }} de {{ dashboard.phases.documentation.total }} concluídos · {{ dashboard.phases.documentation.pct }}%</div>
          <div class="bar"><span id="bar-doc"></span></div>
        </article>
        <article class="phase">
          <div class="phase-title">Deploy</div>
          <div class="phase-numbers">{{ dashboard.phases.deployment.done }} de {{ dashboard.phases.deployment.total }} concluídos · {{ dashboard.phases.deployment.pct }}%</div>
          <div class="bar"><span id="bar-deploy"></span></div>
        </article>
        <article class="phase">
          <div class="phase-title">Migration Project</div>
          <div class="phase-numbers">{{ dashboard.phases.migration_project.done }} de {{ dashboard.phases.migration_project.total }} concluídos · {{ dashboard.phases.migration_project.pct }}%</div>
          <div class="bar"><span id="bar-migration"></span></div>
            <script>
              window.addEventListener('DOMContentLoaded', function() {
                document.getElementById('bar-doc').style.width = '{{ dashboard.phases.documentation.pct|int }}%';
                document.getElementById('bar-deploy').style.width = '{{ dashboard.phases.deployment.pct|int }}%';
                document.getElementById('bar-migration').style.width = '{{ dashboard.phases.migration_project.pct|int }}%';
              });
            </script>
        </article>
      </div>
    </section>

    <section class="layout">
      <article class="panel">
        <h2>Evolução por Grupo</h2>
        <table>
          <thead>
            <tr>
              <th>Grupo</th>
              <th>Itens</th>
              <th>Doc</th>
              <th>Deploy</th>
              <th>Migração</th>
              <th>Em andamento</th>
              <th>Pendentes</th>
              <th>Progresso</th>
            </tr>
          </thead>
          <tbody>
            {% for row in dashboard.groups %}
            <tr>
              <td>{{ row.group_label }}</td>
              <td>{{ row.total }}</td>
              <td>{{ row.done_documentation }}</td>
              <td>{{ row.done_deployment }}</td>
              <td>{{ row.done_migration_project }}</td>
              <td>{{ row.in_progress_any }}</td>
              <td>{{ row.pending_any }}</td>
              <td>{{ row.progress_pct }}%</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        <div class="small-note">Os grupos são ordenados pelos menores níveis de conclusão para facilitar priorização.</div>
      </article>

      <article class="panel">
        <h2>Distribuição por Tipo de Deploy</h2>
        <table>
          <thead>
            <tr>
              <th>Deployment Type</th>
              <th>Itens</th>
              <th>Participação</th>
            </tr>
          </thead>
          <tbody>
            {% for row in dashboard.deployment_breakdown %}
            <tr>
              <td>{{ row.deployment_type }}</td>
              <td>{{ row.count }}</td>
              <td>{{ row.pct }}%</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </article>
    </section>

    <section class="panel">
      <h2>Itens Críticos para Próxima Ação</h2>
      <table>
        <thead>
          <tr>
            <th>Grupo</th>
            <th>Item</th>
            <th>Tipo</th>
            <th>Deploy Type</th>
            <th>Doc</th>
            <th>Deploy</th>
            <th>Migração</th>
            <th>Pendências</th>
          </tr>
        </thead>
        <tbody>
          {% for row in dashboard.critical_items %}
          <tr>
            <td>{{ row.group_label }}</td>
            <td>{{ row.name }}</td>
            <td>{{ row.object_type }}</td>
            <td>{{ row.deployment_type }}</td>
            <td>
              <span class="chip {% if row.status_documentation == 'DONE' %}done{% elif row.status_documentation == 'IN_PROGRESS' %}progress{% else %}pending{% endif %}">
                {{ row.status_documentation }}
              </span>
            </td>
            <td>
              <span class="chip {% if row.status_deployment == 'DONE' %}done{% elif row.status_deployment == 'IN_PROGRESS' %}progress{% else %}pending{% endif %}">
                {{ row.status_deployment }}
              </span>
            </td>
            <td>
              <span class="chip {% if row.status_migration_project == 'DONE' %}done{% elif row.status_migration_project == 'IN_PROGRESS' %}progress{% else %}pending{% endif %}">
                {{ row.status_migration_project }}
              </span>
            </td>
            <td>{{ row.pending_count }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
  </div>
</body>
</html>
